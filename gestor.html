<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel do Gestor - Piel Telecom</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="./css/styles.css">
</head>
<body class="bg-gray-100">

    <div id="auth-check" class="flex items-center justify-center min-h-screen"><p class="text-gray-600 flex items-center gap-2"><i class="fas fa-spinner fa-spin"></i> Verificando autorização...</p></div>
    <div id="access-denied" class="hidden flex flex-col items-center justify-center min-h-screen text-center p-4"><i class="fas fa-exclamation-triangle text-5xl text-red-500 mb-4"></i><h1 class="text-3xl font-bold text-gray-800">Acesso Negado</h1><p class="text-gray-600 mt-2">Você não tem permissão para acessar esta página.</p><a href="./index.html" class="mt-4 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700">Voltar</a></div>

    <div id="manager-app" class="hidden w-full max-w-[95vw] mx-auto bg-white rounded-xl shadow-lg p-4 sm:p-6 my-4">
        <header class="flex flex-col md:flex-row justify-between items-center mb-4 pb-4 border-b gap-4">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">Painel de Gestão</h1>
                <p id="user-info" class="text-sm text-gray-500"></p>
            </div>
            <div class="flex items-center gap-4">
                <a href="http://central.desktop.com.br/" class="text-sm text-blue-600 hover:underline" target="_blank"><i class="fas fa-file-invoice-dollar mr-1"></i> Central do Cliente</a>
                <a href="./index.html" class="text-sm text-blue-600 hover:underline"><i class="fas fa-arrow-left mr-1"></i> Voltar ao Qualificador</a>
            </div>
        </header>

        <main>
            <div class="border-b border-gray-200 mb-4">
                <nav class="flex -mb-px flex-wrap" aria-label="Tabs">
                    <a href="#" id="tab-dashboard" class="nav-tab whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm">
                        <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                    </a>
                    <a href="#" id="tab-vendas" class="nav-tab whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm ml-4">
                        <i class="fas fa-dollar-sign mr-2"></i>Gerenciamento de Vendas
                    </a>
                    <a href="#" id="tab-casos" class="nav-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm ml-4 flex items-center">
    <i class="fas fa-file-signature mr-2"></i>Acompanhamento de Casos
    <span id="case-notification" class="hidden ml-2 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
</a>
                    <a href="#" id="tab-time" class="nav-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm ml-4">
                        <i class="fas fa-users mr-2"></i>Gerenciamento de Time
                    </a>
                </nav>
            </div>

            <div id="dashboard-section" class="page-section">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow border"><h3 class="text-sm font-medium text-gray-500">Total de Leads (no filtro)</h3><p id="kpi-total" class="text-3xl font-bold text-gray-800">0</p></div>
                    <div class="bg-white p-6 rounded-lg shadow border"><h3 class="text-sm font-medium text-gray-500">Vendas Realizadas (vendedores)</h3><p id="kpi-vendas" class="text-3xl font-bold text-gray-800">0</p></div>
                    <div class="bg-white p-6 rounded-lg shadow border"><h3 class="text-sm font-medium text-gray-500">Vendas Agendadas (vendedores)</h3><p id="kpi-agendadas" class="text-3xl font-bold text-gray-800">0</p></div>
                    <div class="bg-white p-6 rounded-lg shadow border"><h3 class="text-sm font-medium text-gray-500">Vendedores Ativos</h3><p id="kpi-vendedores" class="text-3xl font-bold text-gray-800">0</p></div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow border"><h3 class="font-semibold mb-4">Leads por Status (vendedores)</h3><canvas id="statusChart"></canvas></div>
                    <div class="bg-white p-6 rounded-lg shadow border"><h3 class="font-semibold mb-4">Leads por Vendedor (vendedores)</h3><canvas id="vendedorChart"></canvas></div>
                </div>
            </div>

            <div id="vendas-section" class="page-section hidden">
                <div class="flex flex-wrap items-end gap-4 p-4 bg-gray-50 rounded-lg mb-4">
                    <div class="flex-grow w-full md:w-auto"><label for="search-input" class="text-sm font-medium text-gray-700">Pesquisar</label><input type="search" id="search-input" placeholder="Nome, CPF, contato..." class="mt-1 block w-full p-2 border rounded-md text-sm shadow-sm"></div>
                    <div class="flex-grow"><label for="filter-vendedor" class="text-sm font-medium text-gray-700">Vendedor</label><select id="filter-vendedor" class="mt-1 block w-full p-2 border rounded-md text-sm shadow-sm"></select></div>
                    <div class="flex-grow"><label for="filter-status" class="text-sm font-medium text-gray-700">Status</label><select id="filter-status" class="mt-1 block w-full p-2 border rounded-md text-sm shadow-sm"><option value="all">Todos</option><option value="Ativa">Ativas</option><option value="Agendada">Agendadas</option><option value="Pendente">Pendentes</option><option value="Cancelada">Canceladas</option><option value="Suspensa">Suspensas</option></select></div>
                    <div class="flex-grow"><label for="filter-month" class="text-sm font-medium text-gray-700">Mês da Venda</label><input type="month" id="filter-month" class="mt-1 block w-full p-2 border rounded-md text-sm shadow-sm"></div>
                    <div class="flex-grow"><label for="filter-start-date" class="text-sm font-medium text-gray-700">Data Início</label><input type="date" id="filter-start-date" class="mt-1 block w-full p-2 border rounded-md text-sm shadow-sm"></div>
                    <div class="flex-grow"><label for="filter-end-date" class="text-sm font-medium text-gray-700">Data Fim</label><input type="date" id="filter-end-date" class="mt-1 block w-full p-2 border rounded-md text-sm shadow-sm"></div>
                    <div class="flex gap-2"><button id="save-period-btn" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 text-sm">Salvar Período</button><button id="clear-period-btn" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 text-sm">Limpar</button></div>
                </div>
                <div class="overflow-x-auto rounded-lg border"><table class="min-w-full text-sm bg-white"><thead class="bg-gray-100"><tr class="text-left"><th class="p-3 font-semibold">Cliente</th><th class="p-3 font-semibold">Vendedor</th><th class="p-3 font-semibold">Plano</th><th class="p-3 font-semibold">Valor</th><th class="p-3 font-semibold">Status</th><th class="p-3 font-semibold">Data da Venda</th><th class="p-3 font-semibold text-center">Ações</th></tr></thead><tbody id="manager-sales-table"></tbody></table></div>
            </div>

            <div id="casos-section" class="page-section hidden">
                <div class="overflow-x-auto rounded-lg border"><table class="min-w-full text-sm bg-white"><thead class="bg-gray-100"><tr class="text-left"><th class="p-3 font-semibold">Cliente</th><th class="p-3 font-semibold">Vendedor</th><th class="p-3 font-semibold">Data de Retorno</th><th class="p-3 font-semibold">Descrição Breve</th><th class="p-3 font-semibold text-center">Ações</th></tr></thead><tbody id="manager-cases-table"></tbody></table></div>
            </div>
            
            <div id="time-section" class="page-section hidden">
                 <h2 class="text-2xl font-bold text-gray-800 mb-6">Meu Time de Vendedores</h2>
                 <div id="team-members-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
            </div>
        </main>
    </div>

    <div id="saleDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 overflow-y-auto">
        <div class="bg-white rounded-lg shadow-2xl max-w-4xl w-full my-auto flex flex-col h-[95vh]">
            <div class="flex justify-between items-center p-4 border-b sticky top-0 bg-white"><h2 id="modal-title" class="text-xl font-bold text-gray-800"></h2><button id="closeSaleDetailModal" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button></div>
            <div class="p-6 overflow-y-auto flex-1 space-y-6">
                <fieldset class="border p-4 rounded-lg"><legend class="text-lg font-medium text-gray-800 px-2">Dados do Cliente</legend><div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2 text-sm"><div><label class="font-semibold text-gray-500">Nome:</label><p id="detail-nome"></p></div><div><label class="font-semibold text-gray-500">CPF:</label><p id="detail-cpf"></p></div><div><label class="font-semibold text-gray-500">RG:</label><p id="detail-rg"></p></div><div><label class="font-semibold text-gray-500">Nascimento:</label><p id="detail-nascimento"></p></div><div><label class="font-semibold text-gray-500">Telefone:</label><p id="detail-telefone"></p></div><div><label class="font-semibold text-gray-500">E-mail:</label><p id="detail-email"></p></div></div></fieldset>
                <fieldset class="border p-4 rounded-lg"><legend class="text-lg font-medium text-gray-800 px-2">Endereço</legend><div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-2 text-sm"><div class="md:col-span-4"><label class="font-semibold text-gray-500">Endereço Completo:</label><p id="detail-endereco"></p></div><div><label class="font-semibold text-gray-500">Bairro:</label><p id="detail-bairro"></p></div><div><label class="font-semibold text-gray-500">Cidade:</label><p id="detail-cidade"></p></div><div><label class="font-semibold text-gray-500">CEP:</label><p id="detail-cep"></p></div></div></fieldset>
                <fieldset id="venda-details-fieldset" class="border p-4 rounded-lg"><legend class="text-lg font-medium text-gray-800 px-2">Dados da Venda</legend><div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2 text-sm"><div><label class="font-semibold text-gray-500">Plano:</label><p id="detail-plano"></p></div><div><label class="font-semibold text-gray-500">Valor:</label><p id="detail-valor"></p></div><div><label class="font-semibold text-gray-500">Operadora:</label><p id="detail-operadora"></p></div><div><label class="font-semibold text-gray-500">Fonte:</label><p id="detail-fonte"></p></div><div><label class="font-semibold text-gray-500">Vendedor:</label><p id="detail-vendedor"></p></div><div><label class="font-semibold text-gray-500">Data da Venda:</label><p id="detail-data-venda"></p></div><div><label class="font-semibold text-gray-500">Contrato:</label><p id="detail-contrato"></p></div><div><label class="font-semibold text-gray-500">Protocolo:</label><p id="detail-protocolo"></p></div></div><div class="mt-4 text-sm"><label class="font-semibold text-gray-500">Observação do Vendedor:</label><p id="detail-obs-vendedor" class="p-2 bg-gray-50 rounded mt-1 whitespace-pre-wrap"></p></div></fieldset>
                <fieldset id="caso-details-fieldset" class="border p-4 rounded-lg"><legend class="text-lg font-medium text-gray-800 px-2">Detalhes do Caso</legend><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2 text-sm"><div><label class="font-semibold text-gray-500">Prazo de Retorno:</label><p id="detail-prazo"></p></div><div><label class="font-semibold text-gray-500">Nível de Urgência:</label><p id="detail-urgencia"></p></div><div class="col-span-2"><label class="font-semibold text-gray-500">Descrição Detalhada:</label><p id="detail-descricao-caso" class="p-2 bg-gray-50 rounded mt-1 whitespace-pre-wrap"></p></div></div></fieldset>
                <fieldset class="border p-4 rounded-lg bg-blue-50 border-blue-200"><legend class="text-lg font-medium text-blue-800 px-2">Gerenciamento</legend><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-2"><div id="status-management-section"><label for="detail-status" class="block text-sm font-medium text-gray-700 mb-1">Alterar Status</label><select id="detail-status" class="w-full p-2 border rounded-md text-sm shadow-sm"></select><p class="text-xs text-gray-500 mt-1">Última atualização: <span id="detail-data-status"></span></p></div><div><label for="detail-obs-gestor" class="block text-sm font-medium text-gray-700 mb-1">Observação do Gestor</label><textarea id="detail-obs-gestor" rows="3" class="w-full p-2 border rounded-md text-sm shadow-sm" placeholder="Adicione uma nota sobre este caso..."></textarea></div></div></fieldset>
            </div>
            <div class="flex justify-end gap-4 p-4 border-t sticky bottom-0 bg-gray-50"><button id="cancelSaleDetail" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300">Cancelar</button><button id="saveSaleDetail" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700">Salvar Alterações</button></div>
        </div>
    </div>

    <div id="sellerReportModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 overflow-y-auto">
        <div class="bg-white rounded-lg shadow-2xl max-w-6xl w-full my-auto flex flex-col h-[95vh]">
            <div class="flex justify-between items-center p-4 border-b sticky top-0 bg-white z-10"><h2 id="sellerReportModalTitle" class="text-xl font-bold text-gray-800">Relatório do Vendedor</h2><div class="flex items-center gap-4"><button id="exportSellerReportPdf" class="bg-red-600 text-white font-semibold py-2 px-4 rounded-lg flex items-center text-sm"><i class="fas fa-file-pdf mr-2"></i> Baixar PDF</button><button id="closeSellerReportModal" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button></div></div>
            <div id="sellerReportContent" class="p-6 overflow-y-auto flex-1">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200"><h3 class="text-sm font-medium text-green-700">Vendas Ativas</h3><p id="report-kpi-ativas" class="text-2xl font-bold text-green-800">0</p></div>
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200"><h3 class="text-sm font-medium text-blue-700">Vendas Agendadas</h3><p id="report-kpi-agendadas" class="text-2xl font-bold text-blue-800">0</p></div>
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200"><h3 class="text-sm font-medium text-yellow-700">Vendas Pendentes</h3><p id="report-kpi-pendentes" class="text-2xl font-bold text-yellow-800">0</p></div>
                    <div class="bg-red-50 p-4 rounded-lg border border-red-200"><h3 class="text-sm font-medium text-red-700">Vendas Canceladas</h3><p id="report-kpi-canceladas" class="text-2xl font-bold text-red-800">0</p></div>
                </div>

                <div class="mb-6 bg-white p-6 rounded-lg shadow border">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">Desempenho Geral de Qualificações</h3>
                    <canvas id="sellerPerformanceChart"></canvas>
                </div>

                <div class="mb-6"><h3 class="text-lg font-semibold text-gray-700 mb-2">Detalhes das Vendas Ativas</h3><div class="overflow-x-auto rounded-lg border max-h-64"><table class="min-w-full text-xs bg-white"><thead class="bg-gray-100 sticky top-0"><tr class="text-left"><th class="p-2 font-semibold">Data</th><th class="p-2 font-semibold">Cliente</th><th class="p-2 font-semibold">CPF</th><th class="p-2 font-semibold">Plano</th><th class="p-2 font-semibold">Valor</th><th class="p-2 font-semibold">Status</th></tr></thead><tbody id="seller-ativas-table-body"></tbody></table></div></div>
                <div><h3 class="text-lg font-semibold text-gray-700 mb-2">Detalhes das Vendas Canceladas</h3><div class="overflow-x-auto rounded-lg border max-h-64"><table class="min-w-full text-xs bg-white"><thead class="bg-gray-100 sticky top-0"><tr class="text-left"><th class="p-2 font-semibold">Data</th><th class="p-2 font-semibold">Cliente</th><th class="p-2 font-semibold">CPF</th><th class="p-2 font-semibold">Plano</th><th class="p-2 font-semibold">Valor</th><th class="p-2 font-semibold">Status</th></tr></thead><tbody id="seller-canceladas-table-body"></tbody></table></div></div>
            </div>
        </div>
    </div>
    
    <div id="chat-widget-container" class="fixed bottom-4 right-4 z-50 hidden">
        <button id="chat-toggle-btn" class="bg-blue-600 text-white rounded-full w-16 h-16 flex items-center justify-center shadow-lg hover:bg-blue-700 transition-transform transform hover:scale-110"><i class="fas fa-comments fa-2x"></i><span id="chat-notification-badge" class="absolute top-0 right-0 w-4 h-4 bg-red-500 rounded-full border-2 border-white hidden"></span></button>
        <div id="chat-window" class="hidden absolute bottom-20 right-0 w-80 sm:w-96 bg-white rounded-xl shadow-2xl flex flex-col transition-all duration-300 transform opacity-0 translate-y-4" style="height: 500px;">
            <div class="flex-shrink-0 flex justify-between items-center p-4 bg-gray-50 border-b rounded-t-xl"><h3 class="font-bold text-gray-800">Chat Global da Equipe</h3><button id="chat-close-btn" class="text-gray-500 hover:text-gray-800">&times;</button></div>
            <div id="chat-messages-container" class="flex-1 p-4 overflow-y-auto"></div>
            <form id="chat-form" class="flex-shrink-0 p-4 border-t bg-gray-50 rounded-b-xl"><div class="flex items-center gap-2"><input type="text" id="chat-message-input" class="flex-1 w-full px-3 py-2 border rounded-lg" placeholder="Digite sua mensagem..." autocomplete="off"><button type="submit" class="bg-blue-600 text-white font-semibold py-2 px-3 rounded-lg"><i class="fas fa-paper-plane"></i></button></div></form>
        </div>
    </div>
    <audio id="chat-notification-sound" src="https://firebasestorage.googleapis.com/v0/b/qualificacao-a14ff.appspot.com/o/notification.mp3?alt=media&token=c1c2f0f4-9a4f-4a3a-8c8c-1e1b29a8f4b1" preload="auto"></audio>

    <script type="module" src="./js/gestor.js"></script>
</body>
</html>