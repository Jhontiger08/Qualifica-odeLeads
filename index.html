<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qualificador de Leads da Piel Telecom</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html, body { height: 100%; font-family: 'Inter', sans-serif; }
        .status-select {
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em;
            padding-right: 2.5rem; color: #374151; font-weight: 500;
        }
        .status-select.placeholder { color: #374151; background-color: #f9fafb; }
        .status-select.venda-realizada { background-color: #FFC107; color: black; }
        .status-select.em-negociacao { background-color: #87CEEB; color: black; }
        .status-select.aguardando-dados { background-color: #FFD700; color: black; }
        .status-select.sem-interacao { background-color: #BDB76B; color: white; }
        .status-select.sem-viabilidade { background-color: #DC3545; color: white; }
        .status-select.instalacao-concluida { background-color: #28A745; color: white; }
        .status-select.agendada-instalacao { background-color: #4682B4; color: white; }
        .status-select.tentando-reversao { background-color: #8A2BE2; color: white; }
        .status-select.chamei-whatsapp { background-color: #006400; color: white; }
        .status-select.sem-interesse { background-color: #FF4500; color: white; }
        .status-select.ja-cliente { background-color: #696969; color: white; }
        .status-select.sem-porta-cto { background-color: #B22222; color: white; }
        .status-select.golpista-fraude { background-color: #000000; color: white; }
        .status-select.reprovado-credito { background-color: #800000; color: white; }
        .modal-overlay { transition: opacity 0.3s ease; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Painel Principal -->
    <div id="app" class="w-full max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-4 sm:p-6 md:p-8 my-4 sm:my-8">
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
            <div class="text-center md:text-left">
                 <h1 class="text-xl sm:text-2xl md:text-3xl font-bold text-gray-800">Painel de Qualificação de Leads</h1>
                 <p class="text-base sm:text-lg text-gray-600">Piel Telecom (Colaborativo)</p>
            </div>
            <div class="flex flex-wrap justify-center md:justify-end gap-2">
                <button id="addRowBtn" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center"><i class="fas fa-plus mr-2"></i> Adicionar</button>
                <button id="downloadBtn" class="bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center"><i class="fas fa-download mr-2"></i> Baixar CSV</button>
                <button id="resetBtn" class="bg-orange-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 flex items-center"><i class="fas fa-sync-alt mr-2"></i> Resetar</button>
            </div>
        </div>
        <div class="overflow-x-auto rounded-lg border border-gray-200">
            <table class="min-w-full bg-white">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="text-left p-2 md:px-4 font-semibold text-xs sm:text-sm text-gray-600 uppercase tracking-wider">Contato</th>
                        <th class="text-left p-2 md:px-4 font-semibold text-xs sm:text-sm text-gray-600 uppercase tracking-wider">Vendedor(a)</th>
                        <th class="text-left p-2 md:px-4 font-semibold text-xs sm:text-sm text-gray-600 uppercase tracking-wider">Qualificação</th>
                        <th class="text-left p-2 md:px-4 font-semibold text-xs sm:text-sm text-gray-600 uppercase tracking-wider">CEP</th>
                        <th class="text-left p-2 md:px-4 font-semibold text-xs sm:text-sm text-gray-600 uppercase tracking-wider">Observação Rápida</th>
                        <th class="text-center p-2 md:px-4 font-semibold text-xs sm:text-sm text-gray-600 uppercase tracking-wider">Ações</th>
                    </tr>
                </thead>
                <tbody id="leadsTableBody" class="text-gray-700"></tbody>
            </table>
        </div>
    </div>

    <!-- Modal de Confirmação de Reset -->
    <div id="resetModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 modal-overlay hidden z-50"><div class="bg-white rounded-lg shadow-2xl p-6 md:p-8 max-w-sm w-full"><h2 class="text-xl font-bold text-gray-800 mb-4">Confirmar Ação</h2><p class="text-gray-600 mb-6">Você tem certeza que deseja apagar todos os leads? Esta ação não pode ser desfeita.</p><div class="flex justify-end gap-4"><button id="cancelReset" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300">Cancelar</button><button id="confirmReset" class="bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700">Confirmar</button></div></div></div>
    
    <!-- Modal de Formular Caso -->
    <div id="caseModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 modal-overlay hidden z-50 overflow-y-auto">
        <div class="bg-white rounded-lg shadow-2xl max-w-3xl w-full my-auto flex flex-col">
            <div class="flex justify-between items-center p-6 border-b sticky top-0 bg-white rounded-t-lg">
                <h2 class="text-xl font-bold text-gray-800">Formulário de Caso</h2>
                <button id="closeCaseModal" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button>
            </div>
            <div class="p-6 space-y-4 overflow-y-auto max-h-[70vh]">
                <!-- Dados não editáveis -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg">
                    <div><label class="block text-sm font-medium text-gray-500">Contato</label><p id="caseContato" class="mt-1 text-gray-900 font-semibold"></p></div>
                    <div><label class="block text-sm font-medium text-gray-500">Qualificação</label><p id="caseQualificacao" class="mt-1 text-gray-900 font-semibold"></p></div>
                    <div><label class="block text-sm font-medium text-gray-500">CEP</label><p id="caseCep" class="mt-1 text-gray-900 font-semibold"></p></div>
                </div>
                <!-- Dados Editáveis -->
                <div>
                    <label for="caseNomeCompleto" class="block text-sm font-medium text-gray-700">Nome Completo</label>
                    <input type="text" id="caseNomeCompleto" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label for="caseCpfCnpj" class="block text-sm font-medium text-gray-700">CPF/CNPJ</label><input type="text" id="caseCpfCnpj" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></div>
                    <div><label for="caseEmail" class="block text-sm font-medium text-gray-700">E-mail</label><input type="email" id="caseEmail" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div><label for="caseRua" class="block text-sm font-medium text-gray-700">Rua</label><input type="text" id="caseRua" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></div>
                    <div><label for="caseNumero" class="block text-sm font-medium text-gray-700">Número</label><input type="text" id="caseNumero" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></div>
                    <div><label for="caseBairro" class="block text-sm font-medium text-gray-700">Bairro</label><input type="text" id="caseBairro" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></div>
                </div>
                <div><label for="caseCidade" class="block text-sm font-medium text-gray-700">Cidade</label><input type="text" id="caseCidade" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></div>
                <div>
                    <label for="caseTextArea" class="block text-sm font-medium text-gray-700">Descrição do Caso</label>
                    <textarea id="caseTextArea" rows="6" class="mt-1 w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Descreva detalhadamente o caso..."></textarea>
                </div>
            </div>
            <div class="flex justify-end gap-4 p-6 border-t sticky bottom-0 bg-white rounded-b-lg">
                <button id="cancelCaseModal" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300">Cancelar</button>
                <button id="saveCaseModal" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700">Salvar Caso</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Importações do Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, getDocs, getDoc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCTAaa5sF_O4S38FpyV_mL2hpB0xGXgAv4",
            authDomain: "qualificacao-a14ff.firebaseapp.com",
            projectId: "qualificacao-a14ff",
            storageBucket: "qualificacao-a14ff.appspot.com",
            messagingSenderId: "955642076737",
            appId: "1:955642076737:web:f6db77134cd6a18b8f30c0"
        };

        // Inicialização do Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Elementos do DOM
        const addRowBtn = document.getElementById('addRowBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const resetBtn = document.getElementById('resetBtn');
        const tableBody = document.getElementById('leadsTableBody');
        const resetModal = document.getElementById('resetModal');
        const cancelReset = document.getElementById('cancelReset');
        const confirmReset = document.getElementById('confirmReset');
        const caseModal = document.getElementById('caseModal');
        const closeCaseModal = document.getElementById('closeCaseModal');
        const cancelCaseModal = document.getElementById('cancelCaseModal');
        const saveCaseModal = document.getElementById('saveCaseModal');
        
        let currentEditingDocId = null;

        // Mapeamento de cores para as tags
        const statusColorClasses = {
            'Venda Realizada': 'venda-realizada', 'Em Negociação': 'em-negociacao', 'Aguardando Dados': 'aguardando-dados',
            'Sem Interação - Retrabalhar': 'sem-interacao', 'Sem Viabilidade': 'sem-viabilidade', 'Instalação Concluída': 'instalacao-concluida', 
            'Agendada Instalação': 'agendada-instalacao', 'Tentando Reversão': 'tentando-reversao', 'Chamei no meu WhatsApp Business': 'chamei-whatsapp',
            'Sem Interesse nos Planos': 'sem-interesse', 'Já é Cliente': 'ja-cliente', 'Sem Porta CTO': 'sem-porta-cto', 
            'Golpista/Fraude': 'golpista-fraude', 'Reprovado Crédito': 'reprovado-credito'
        };
        
        // --- LÓGICA DO FIRESTORE (CRUD) ---
        
        function listenToLeads() {
            const leadsCollection = collection(db, 'leads');
            const q = query(leadsCollection, orderBy('createdAt', 'desc'));
            onSnapshot(q, (snapshot) => {
                const existingIds = new Set(Array.from(tableBody.querySelectorAll('tr')).map(tr => tr.dataset.id));
                const snapshotIds = new Set();
                snapshot.docs.forEach(doc => {
                    snapshotIds.add(doc.id);
                    const existingRow = tableBody.querySelector(`tr[data-id="${doc.id}"]`);
                    if (existingRow) {
                        updateLeadRow(existingRow, doc.data());
                    } else {
                        renderLeadRow(doc);
                    }
                });
                existingIds.forEach(id => {
                    if (!snapshotIds.has(id)) {
                        const rowToRemove = tableBody.querySelector(`tr[data-id="${id}"]`);
                        if(rowToRemove) rowToRemove.remove();
                    }
                });
            }, (error) => console.error("Erro ao ouvir os leads:", error));
        }
        
        async function addNewLead() {
            try {
                await addDoc(collection(db, 'leads'), {
                    contato: '', vendedor: '', qualificação: '', cep: '', observacao_rapida: '',
                    nome_completo: '', cpf_cnpj: '', email: '', rua: '', numero: '', bairro: '', cidade: '', descricao_caso: '',
                    createdAt: serverTimestamp()
                });
            } catch (error) {
                console.error("Erro ao adicionar lead: ", error);
            }
        }
        
        addRowBtn.addEventListener('click', () => {
            const lastRow = tableBody.firstElementChild;
            let canAdd = true;
            if (lastRow) {
                const inputs = lastRow.querySelectorAll('input[data-field], select[data-field]');
                const [contatoInput, vendedorInput, qualificacaoSelect] = inputs;
                [contatoInput, vendedorInput, qualificacaoSelect].forEach(el => el.classList.remove('border-red-500', 'ring-red-500'));
                if (!contatoInput.value.trim()) {
                    contatoInput.classList.add('border-red-500', 'ring-red-500');
                    canAdd = false;
                }
                if (!vendedorInput.value.trim()) {
                    vendedorInput.classList.add('border-red-500', 'ring-red-500');
                    canAdd = false;
                }
                if (!qualificacaoSelect.value) {
                    qualificacaoSelect.classList.add('border-red-500', 'ring-red-500');
                    canAdd = false;
                }
            }
            if (canAdd) addNewLead();
        });

        async function updateLead(docId, data) {
            const docRef = doc(db, 'leads', docId);
            try {
                await updateDoc(docRef, data);
            } catch (error) {
                console.error("Erro ao atualizar lead: ", error);
            }
        }

        async function deleteLead(docId) {
            const docRef = doc(db, 'leads', docId);
            try {
                await deleteDoc(docRef);
            } catch (error) {
                console.error("Erro ao deletar lead: ", error);
            }
        }

        // --- RENDERIZAÇÃO E EVENTOS DA TABELA ---

        function renderLeadRow(doc) {
            const data = doc.data();
            const tr = document.createElement('tr');
            tr.className = 'border-b border-gray-200 hover:bg-gray-50';
            tr.dataset.id = doc.id;

            tr.innerHTML = `
                <td class="p-2 align-middle"><input type="text" value="${data.contato || ''}" data-field="contato" class="w-full px-2 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Contato do Lead"></td>
                <td class="p-2 align-middle"><input type="text" value="${data.vendedor || ''}" data-field="vendedor" class="w-full px-2 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nome do vendedor"></td>
                <td class="p-2 align-middle">
                    <select data-field="qualificacao" class="w-full px-2 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 status-select">
                        <option value="" ${!data.qualificacao ? 'selected' : ''} disabled>Selecione</option>
                        ${Object.keys(statusColorClasses).map(status => `<option value="${status}" ${data.qualificacao === status ? 'selected' : ''}>${status}</option>`).join('')}
                    </select>
                </td>
                <td class="p-2 align-middle"><input type="text" value="${data.cep || ''}" data-field="cep" class="w-full px-2 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="CEP"></td>
                <td class="p-2 align-middle"><input type="text" value="${data.observacao_rapida || ''}" data-field="observacao_rapida" class="w-full px-2 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nota rápida..."></td>
                <td class="p-2 text-center align-middle">
                    <div class="flex items-center justify-center gap-2">
                        <button class="openCaseModalBtn text-blue-600 hover:text-blue-800 p-2 rounded-full flex-shrink-0" title="Formular Caso"><i class="fas fa-file-alt fa-lg"></i></button>
                        <button class="removeRowBtn text-red-500 hover:text-red-700 p-2 rounded-full flex-shrink-0" title="Excluir Lead"><i class="fas fa-trash-alt fa-lg"></i></button>
                    </div>
                </td>
            `;
            tableBody.insertBefore(tr, tableBody.firstChild);
            updateSelectColor(tr.querySelector('select'));
        }
        
        function updateLeadRow(row, data) {
            row.querySelector('[data-field="contato"]').value = data.contato || '';
            row.querySelector('[data-field="vendedor"]').value = data.vendedor || '';
            const select = row.querySelector('[data-field="qualificacao"]');
            select.value = data.qualificacao || '';
            updateSelectColor(select);
            row.querySelector('[data-field="cep"]').value = data.cep || '';
            row.querySelector('[data-field="observacao_rapida"]').value = data.observacao_rapida || '';
        }

        tableBody.addEventListener('input', (e) => {
            const target = e.target;
            if (target.matches('input, select')) {
                target.classList.remove('border-red-500', 'ring-red-500');
                const docId = target.closest('tr').dataset.id;
                const field = target.dataset.field;
                const value = target.value;
                updateLead(docId, { [field]: value });
                if (target.tagName === 'SELECT') {
                    updateSelectColor(target);
                }
            }
        });

        tableBody.addEventListener('click', (e) => {
            const removeButton = e.target.closest('.removeRowBtn');
            if (removeButton) {
                const docId = removeButton.closest('tr').dataset.id;
                deleteLead(docId);
            }
            const openCaseButton = e.target.closest('.openCaseModalBtn');
            if (openCaseButton) {
                const docId = openCaseButton.closest('tr').dataset.id;
                const docRef = doc(db, 'leads', docId);
                getDoc(docRef).then(docSnap => {
                    if (docSnap.exists()) {
                        openCaseModal(docId, docSnap.data());
                    }
                });
            }
        });

        function updateSelectColor(select) {
            Object.values(statusColorClasses).forEach(cls => select.classList.remove(cls));
            select.classList.remove('placeholder');
            const selectedValue = select.value;
            if (selectedValue && statusColorClasses[selectedValue]) {
                select.classList.add(statusColorClasses[selectedValue]);
            } else {
                select.classList.add('placeholder');
            }
        }

        // --- LÓGICA DO MODAL DE CASO ---

        function openCaseModal(docId, data) {
            currentEditingDocId = docId;
            document.getElementById('caseContato').textContent = data.contato || 'Não informado';
            document.getElementById('caseQualificacao').textContent = data.qualificacao || 'Não informada';
            document.getElementById('caseCep').textContent = data.cep || 'Não informado';
            document.getElementById('caseNomeCompleto').value = data.nome_completo || '';
            document.getElementById('caseCpfCnpj').value = data.cpf_cnpj || '';
            document.getElementById('caseEmail').value = data.email || '';
            document.getElementById('caseRua').value = data.rua || '';
            document.getElementById('caseNumero').value = data.numero || '';
            document.getElementById('caseBairro').value = data.bairro || '';
            document.getElementById('caseCidade').value = data.cidade || '';
            document.getElementById('caseTextArea').value = data.descricao_caso || '';
            caseModal.classList.remove('hidden');
        }

        function closeTheCaseModal() {
            caseModal.classList.add('hidden');
            currentEditingDocId = null;
        }

        closeCaseModal.addEventListener('click', closeTheCaseModal);
        cancelCaseModal.addEventListener('click', closeTheCaseModal);
        saveCaseModal.addEventListener('click', () => {
            if (currentEditingDocId) {
                const dataToSave = {
                    nome_completo: document.getElementById('caseNomeCompleto').value,
                    cpf_cnpj: document.getElementById('caseCpfCnpj').value,
                    email: document.getElementById('caseEmail').value,
                    rua: document.getElementById('caseRua').value,
                    numero: document.getElementById('caseNumero').value,
                    bairro: document.getElementById('caseBairro').value,
                    cidade: document.getElementById('caseCidade').value,
                    descricao_caso: document.getElementById('caseTextArea').value
                };
                updateLead(currentEditingDocId, dataToSave);
                closeTheCaseModal();
            }
        });


        // --- BOTÕES DE AÇÃO (DOWNLOAD E RESET) ---
        downloadBtn.addEventListener('click', async function() {
            const headers = ["Contato", "Vendedor", "Qualificacao", "CEP", "Observacao Rapida", "Nome Completo", "CPF/CNPJ", "E-mail", "Rua", "Numero", "Bairro", "Cidade", "Descricao do Caso"];
            let csvRows = [];
            csvRows.push(headers.join(';'));
            
            const leadsCollection = collection(db, 'leads');
            const q = query(leadsCollection, orderBy('createdAt', 'desc'));
            const snapshot = await getDocs(q);

            snapshot.docs.forEach(doc => {
                const data = doc.data();
                const cols = [
                    `"${data.contato || ''}"`, `"${data.vendedor || ''}"`, `"${data.qualificacao || ''}"`,
                    `"${data.cep || ''}"`, `"${data.observacao_rapida || ''}"`, `"${data.nome_completo || ''}"`,
                    `"${data.cpf_cnpj || ''}"`, `"${data.email || ''}"`, `"${data.rua || ''}"`, `"${data.numero || ''}"`,
                    `"${data.bairro || ''}"`, `"${data.cidade || ''}"`, `"${(data.descricao_caso || '').replace(/"/g, '""')}"`
                ];
                csvRows.push(cols.join(';'));
            });

            const csvString = csvRows.join('\r\n');
            const blob = new Blob([`\uFEFF${csvString}`], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            const date = new Date();
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const formattedDate = `${day}-${month}-${year}`;
            link.setAttribute("download", `QL '${formattedDate}'.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        resetBtn.addEventListener('click', () => resetModal.classList.remove('hidden'));
        cancelReset.addEventListener('click', () => resetModal.classList.add('hidden'));
        confirmReset.addEventListener('click', async () => {
            const leadsCollection = collection(db, 'leads');
            const snapshot = await getDocs(leadsCollection);
            const deletePromises = snapshot.docs.map(doc => deleteDoc(doc.ref));
            await Promise.all(deletePromises);
            await addNewLead();
            resetModal.classList.add('hidden');
        });

        // Inicia a aplicação
        async function startApp() {
            const leadsCollection = collection(db, 'leads');
            const initialSnapshot = await getDocs(leadsCollection);
            if (initialSnapshot.empty) {
                await addNewLead();
            }
            listenToLeads();
        }

        startApp();
    </script>
</body>
</html>
